# Makefile to automatically convert the .jsonnet GHA workflows
# to .yml (GHA accepts only the YAML format).

LIBS =
OBJS = build-and-test.yml

all: $(OBJS)

%.yml: %.jsonnet $(LIBS)
	echo "# AUTOGENERATED FROM $< DO NOT MODIFY" > $@
	./jsonnet_to_yaml.sh $< >> $@ || { rm -f $@; exit 1; }

clean:
	rm -f $(OBJS)

format:
	jsonnetfmt -i *.jsonnet

# for pad's codemap
.PHONY: gen-codemapignore
gen-codemapignore: $(OBJS)
	rm -f .codemapignore
	for i in $(OBJS);  do \
		echo $$i >> .codemapignore; \
	done
